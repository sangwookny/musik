<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Musiklexikon</title>
    <style>
        :root { --bg: #FDFBF7; --ink: #222; --sub: #666; --accent: #0056D6; --paper: #FFF; }
        body { background: var(--bg); color: var(--ink); margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Pretendard", sans-serif; -webkit-font-smoothing: antialiased; }
        .app-header { padding: 15px 20px; background: rgba(253, 251, 247, 0.95); position: sticky; top: 0; z-index: 99; border-bottom: 1px solid rgba(0,0,0,0.05); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: space-between; height: 50px; }
        .header-title { font-family: "Times New Roman", serif; font-size: 22px; font-weight: 700; }
        .back-btn { font-size: 24px; cursor: pointer; padding: 10px; display: none; color: var(--accent); margin-left: -10px; }
        
        #listView, #detailView { max-width: 600px; margin: 0 auto; padding: 20px; }
        #detailView { display: none; padding-bottom: 100px; }

        /* List Card */
        .entry-card { background: var(--paper); border-radius: 12px; padding: 20px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.03); border: 1px solid #EFEFEF; cursor: pointer; transition: 0.1s; }
        .entry-card:active { transform: scale(0.98); background: #F5F5F7; }
        .entry-num { font-family: "Times New Roman", serif; font-size: 18px; font-weight: 700; color: var(--accent); min-width: 45px; }
        .entry-main { flex: 1; }
        .entry-tit { font-family: "Times New Roman", serif; font-size: 18px; font-weight: 500; display: block; margin-bottom: 4px; }
        .entry-desc { font-size: 13px; color: var(--sub); display: block; line-height: 1.3; }

        /* Detail */
        .sec-tit { font-weight: 700; margin-top: 35px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; font-size: 14px; color: var(--ink); text-transform: uppercase; letter-spacing: 0.5px; }
        .de-text { font-family: "Times New Roman", serif; font-size: 21px; line-height: 1.5; padding: 20px; border-radius: 12px; cursor: pointer; background: #FFF; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border-left: 4px solid transparent; margin-bottom: 15px; transition: 0.2s; }
        .de-text.active { background: #E8F0FE; border-left-color: var(--accent); transform: scale(1.01); }
        
        .tutor-box { display: none; background: #FFF; border: 1px solid #EEE; border-radius: 12px; padding: 24px; margin-bottom: 25px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); animation: slide 0.3s; }
        @keyframes slide { from {opacity:0; transform:translateY(-10px);} to {opacity:1;} }
        
        .trans-text { font-weight: 600; font-size: 16px; line-height: 1.6; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #EEE; }
        .v-item { font-size: 14px; margin-bottom: 8px; }
        .v-word { color: var(--accent); font-weight: 700; font-family: "Times New Roman", serif; font-size: 16px; margin-right: 6px; }
        .g-box { background: #F7F9FC; padding: 15px; border-radius: 8px; font-size: 13px; margin-top: 20px; border-left: 3px solid var(--accent); line-height: 1.6; color: #444; }
        .spk-btn { border: 1px solid #DDD; background: transparent; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #666; }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="back-btn" id="backBtn" onclick="goBack()">‚Üê</div>
        <div class="header-title" id="headerTitle">Musiklexikon</div>
        <div style="width: 24px;"></div>
    </div>
    <div id="listView"></div>
    <div id="detailView"></div>

    <script src="data.js"></script>

    <script>
        const listV = document.getElementById('listView');
        const detailV = document.getElementById('detailView');
        const hTitle = document.getElementById('headerTitle');
        const bBtn = document.getElementById('backBtn');

        function init() {
            renderList();
            const id = new URLSearchParams(window.location.search).get('id');
            if(id) openDetail(id);
        }

        function renderList() {
            listV.innerHTML = '';
            musicData.forEach(d => {
                const el = document.createElement('div');
                el.className = 'entry-card';
                el.onclick = () => { history.pushState(null,'',`?id=${d.id}`); openDetail(d.id); };
                el.innerHTML = `<div class="entry-num">${d.id}</div><div class="entry-main"><span class="entry-tit">${d.title}</span><span class="entry-desc">${d.desc}</span></div><div style="color:#DDD;font-size:20px;">‚Ä∫</div>`;
                listV.appendChild(el);
            });
        }

        function openDetail(id) {
            const d = musicData.find(x => x.id === id);
            if(!d) return;
            listV.style.display='none'; detailV.style.display='block'; bBtn.style.display='block';
            hTitle.innerText = `${d.id}. ${d.title}`; window.scrollTo(0,0);
            
            detailV.innerHTML = d.sections.map((s,i) => `
                <div class="sec-tit"><span>${s.type}</span><button class="spk-btn" onclick="speak(this, '${s.german.replace(/'/g,"\\'")}')">üîä</button></div>
                <div class="de-text" onclick="toggle(${i}, this)">${s.german}</div>
                <div id="t-${i}" class="tutor-box">
                    <div class="trans-text">${s.translation}</div>
                    ${s.vocab ? `<div style="margin-bottom:10px;font-size:11px;color:#999;font-weight:700;">VOKABELN</div>`+s.vocab.map(v=>`<div class="v-item"><span class="v-word">${v.word}</span><span>${v.mean}</span></div>`).join('') : ''}
                    ${s.grammar ? `<div class="g-box"><strong>üí° Checkpoint</strong><br>${s.grammar}</div>` : ''}
                </div>
            `).join('');
        }

        function goBack() {
            listV.style.display='block'; detailV.style.display='none'; bBtn.style.display='none';
            hTitle.innerText = 'Musiklexikon'; history.pushState(null,'',window.location.pathname);
        }

        window.toggle = (i, el) => {
            const box = document.getElementById(`t-${i}`);
            const open = box.style.display === 'block';
            document.querySelectorAll('.tutor-box').forEach(x=>x.style.display='none');
            document.querySelectorAll('.de-text').forEach(x=>x.classList.remove('active'));
            if(!open) { box.style.display='block'; el.classList.add('active'); setTimeout(()=>el.scrollIntoView({behavior:'smooth',block:'center'}),100); }
        };

        window.speak = (btn, txt) => {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(txt); u.lang='de-DE'; u.rate=0.8;
            window.speechSynthesis.speak(u);
            btn.style.background='#EEE'; setTimeout(()=>btn.style.background='transparent', 1000);
        };
        
        window.onpopstate = () => new URLSearchParams(window.location.search).get('id') ? openDetail(new URLSearchParams(window.location.search).get('id')) : goBack();
        
        init();
    </script>
</body>
</html>
